<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EMV Decoder</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  background: #020617;
  color: #e5e7eb;
  font-family: Consolas, monospace;
  padding: 20px;
}
button {
  padding: 10px 20px;
  background: #2563eb;
  border: none;
  border-radius: 6px;
  color: white;
  cursor: pointer;
  margin-right: 10px;
}
textarea, input {
  width: 100%;
  background: #020617;
  color: #22c55e;
  border: 1px solid #334155;
  padding: 10px;
  margin-top: 10px;
}
.card {
  background: #0b1224;
  border: 1px solid #1f2937;
  border-radius: 10px;
  padding: 15px;
  margin-top: 15px;
}
pre { white-space: pre-wrap; }
.hidden { display: none; }
</style>
</head>

<body>

<h2>EMV Decoder</h2>

<button onclick="show('f60')">Field 60 Decoder</button>
<button onclick="show('iad')">9F10 (IAD) Decoder</button>

<!-- FIELD 60 -->
<div id="f60" class="hidden">
  <h3>Field 60 Decoder</h3>
  <textarea id="f60hex" placeholder="Paste Field 60 hex"></textarea>
  <button onclick="decodeField60()">Decode Field 60</button>
  <div id="f60out"></div>
</div>

<!-- 9F10 -->
<div id="iad" class="hidden">
  <h3>9F10 (Issuer Application Data)</h3>
  <input id="iadhex" placeholder="Paste full 9F10 TLV">
  <button onclick="decodeIAD()">Decode 9F10</button>
  <div id="iadout"></div>
</div>

<script>
function show(id) {
  document.getElementById('f60').classList.add('hidden');
  document.getElementById('iad').classList.add('hidden');
  document.getElementById(id).classList.remove('hidden');
}

/* ----------------- EMV TLV PARSER ----------------- */
function parseTLV(hex) {
  let i = 0, out = "";
  while (i < hex.length) {
    let tag = hex.substr(i,2); i+=2;
    if ((parseInt(tag,16) & 0x1F) === 0x1F) {
      tag += hex.substr(i,2); i+=2;
    }

    let len = parseInt(hex.substr(i,2),16); i+=2;
    if (len & 0x80) {
      const bytes = len & 0x7F;
      len = parseInt(hex.substr(i, bytes*2),16);
      i += bytes*2;
    }

    let value = hex.substr(i, len*2);
    i += len*2;

    out += `TAG ${tag}\nLEN ${len}\nVAL ${value}\n\n`;
  }
  return out;
}

/* ----------------- FIELD 60 ----------------- */
function decodeField60() {
  const h = document.getElementById("f60hex").value.trim();
  let o = "";

  const version = h.substr(0,2);
  const blockId = h.substr(2,2);
  const tableId = h.substr(4,2);
  const len = parseInt(h.substr(6,4),16);
  const data = h.substr(10, len*2);

  o += `<div class="card"><pre>
Version : ${version}
BlockId : ${blockId}
TableId : ${tableId}
Length  : ${len}
Data    : ${data}
</pre></div>`;

  o += `<div class="card"><pre>
--- EMV TLV INSIDE FIELD 60 ---
${parseTLV(data)}
</pre></div>`;

  document.getElementById("f60out").innerHTML = o;
}

/* ----------------- 9F10 (IAD) ----------------- */
function hexToBin(h) {
  return h.split('').map(x => parseInt(x,16).toString(2).padStart(4,'0')).join('');
}

function decodeIAD() {
  const d = document.getElementById("iadhex").value.trim();
  let o = "";

  const iad = d.substr(6); // skip 9F10 + len
  const CAII = iad.substr(0,2);
  const DKI  = iad.substr(2,2);
  const CVR  = iad.substr(4,16);

  o += `<div class="card"><pre>
CAII : ${CAII} (${hexToBin(CAII)})
DKI  : ${DKI}
CVR  : ${CVR}
</pre></div>`;

  document.getElementById("iadout").innerHTML = o;
}
</script>
</body>
</html>

